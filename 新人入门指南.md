# Moatless Tree Search 新人入门指南

## 🎯 学习目标

通过这个指南，你将：
- 理解项目的核心概念和工作原理
- 掌握项目的使用方法
- 了解代码结构和关键组件
- 能够进行基础的开发和调试

## 📚 学习路径规划

### 第一阶段：基础理解（1-2天）

#### 1.1 项目概览
**必读文档：**
- 📖 `README.md` - 项目基本介绍
- 📖 `项目流程说明.md` - 核心流程理解

**学习重点：**
- 什么是蒙特卡洛树搜索？
- 项目解决什么问题？
- 整体工作流程是怎样的？

**实践任务：**
```bash
# 1. 克隆项目
git clone <project-url>
cd moatless-tree-search

# 2. 查看项目结构
ls -la
tree -L 2  # 如果有tree命令

# 3. 阅读核心文档
```

#### 1.2 环境搭建
**步骤：**
```bash
# 1. 安装依赖
pip install moatless-tree-search

# 2. 设置环境变量
export OPENAI_API_KEY="your-key"
export VOYAGE_API_KEY="your-key"
export INDEX_STORE_DIR="/tmp/index_store"
export REPO_DIR="/tmp/repos"

# 3. 验证安装
python -c "import moatless; print('安装成功!')"
```

**注意事项：**
- 需要申请OpenAI和Voyage AI的API密钥
- 确保Python版本在3.10-3.13之间
- 如果是Mac M1/M2，需要特殊处理graphviz

### 第二阶段：动手实践（2-3天）

#### 2.1 运行第一个示例
**简单示例：**
```bash
# 运行基础评估
moatless-evaluate \
    --model "gpt-4o-mini" \
    --repo_base_dir /tmp/repos \
    --eval_dir "./evaluations" \
    --max_iterations 10 \
    --instance_ids "django__django-16379"
```

**观察要点：**
- 搜索过程的日志输出
- 生成的文件和目录
- 最终的结果文件

#### 2.2 可视化界面体验
```bash
# 启动可视化界面
moatless-streamlit trajectory.json
```

**学习重点：**
- 理解搜索树的可视化
- 观察节点状态标识
- 分析搜索路径

#### 2.3 理解输出结果
**关键文件：**
- `trajectory.json` - 完整搜索记录
- 修改后的代码文件
- 评估报告

### 第三阶段：代码理解（3-5天）

#### 3.1 项目结构深入
**核心目录解析：**
```
moatless/
├── search_tree.py      # 🔥 核心：搜索树实现
├── node.py            # 🔥 核心：节点数据结构
├── selector/          # 🔥 核心：节点选择策略
├── value_function/    # 🔥 核心：价值函数评估
├── actions/           # 重要：各种动作实现
├── agent/             # 重要：AI智能体
├── completion/        # 重要：LLM接口
├── index/             # 重要：代码索引
└── benchmark/         # 评估框架
```

**学习顺序：**
1. 先看 `search_tree.py` 了解主流程
2. 再看 `node.py` 理解数据结构
3. 然后看 `selector/` 理解选择算法
4. 最后看 `actions/` 了解具体动作

#### 3.2 核心算法理解
**重点文件：**
```python
# 1. 搜索树主循环
moatless/search_tree.py:run_search()

# 2. UCT算法实现
moatless/selector/selector.py:uct_score()

# 3. 价值函数评估
moatless/value_function/base.py:get_reward()

# 4. 动作执行
moatless/actions/action.py:execute()
```

**学习方法：**
- 逐行阅读关键函数
- 理解算法的数学原理
- 画出数据流图

#### 3.3 调试和日志
**开启详细日志：**
```python
import logging
logging.basicConfig(level=logging.DEBUG)
```

**关键日志点：**
- 节点选择过程
- UCT分数计算
- 动作执行结果
- 价值函数评估

### 第四阶段：深入开发（5-7天）

#### 4.1 自定义动作
**创建新动作：**
```python
from moatless.actions.action import Action

class MyCustomAction(Action):
    def execute(self, file_context):
        # 实现你的自定义逻辑
        pass
```

#### 4.2 调整搜索策略
**修改选择器参数：**
```python
selector = BestFirstSelector(
    exploitation_weight=2.0,  # 增加利用权重
    exploration_weight=0.5,   # 减少探索权重
    diversity_weight=150.0    # 增加多样性权重
)
```

#### 4.3 自定义价值函数
```python
class MyValueFunction(ValueFunction):
    def calculate_reward(self, node):
        # 实现自定义评估逻辑
        return Reward(value=score, explanation=reason)
```

### 第五阶段：贡献开发（持续）

#### 5.1 运行测试
```bash
# 运行所有测试
pytest

# 运行特定测试
pytest tests/test_search_tree.py

# 运行集成测试
pytest --run-llm-integration
```

#### 5.2 性能分析
```python
# 使用性能分析工具
import cProfile
cProfile.run('search_tree.run_search()')
```

#### 5.3 贡献代码
- 修复bug
- 添加新功能
- 改进文档
- 优化性能

## 🛠️ 实用工具和技巧

### 调试技巧
```python
# 1. 设置断点
import pdb; pdb.set_trace()

# 2. 打印搜索树状态
print(generate_ascii_tree(search_tree.root))

# 3. 查看节点详情
print(f"Node {node.node_id}: reward={node.reward}, visits={node.visits}")
```

### 常用命令
```bash
# 查看项目统计
find . -name "*.py" | xargs wc -l

# 搜索特定代码
grep -r "UCT" moatless/

# 查看依赖
pip list | grep -E "(moatless|pydantic|litellm)"
```

### 学习资源
- 📚 **蒙特卡洛树搜索**: [Wikipedia MCTS](https://en.wikipedia.org/wiki/Monte_Carlo_tree_search)
- 📚 **UCT算法**: 理解Upper Confidence bounds applied to Trees
- 📚 **SWE-Bench**: 了解软件工程基准测试
- 📚 **LLM应用**: 学习大语言模型在代码生成中的应用

## ⚠️ 常见问题和解决方案

### 环境问题
```bash
# API密钥问题
echo $OPENAI_API_KEY  # 检查是否设置

# 依赖问题
pip install --upgrade moatless-tree-search

# Mac M1/M2 graphviz问题
brew install graphviz
export CFLAGS="-I $(brew --prefix graphviz)/include"
export LDFLAGS="-L $(brew --prefix graphviz)/lib"
```

### 运行问题
- **内存不足**: 减少 `max_iterations` 参数
- **API限制**: 检查API配额和限制
- **网络问题**: 确保能访问OpenAI和Voyage AI

### 理解难点
- **UCT算法**: 先理解基本的树搜索，再学习UCT的改进
- **价值函数**: 理解如何评估代码修改的质量
- **多智能体**: 理解不同AI如何协作决策

## 📈 学习进度检查

### 第一周目标
- [ ] 成功运行第一个示例
- [ ] 理解项目的基本工作流程
- [ ] 能够解读搜索结果

### 第二周目标
- [ ] 理解核心算法原理
- [ ] 能够调整基本参数
- [ ] 可以阅读和理解核心代码

### 第三周目标
- [ ] 能够自定义简单功能
- [ ] 理解性能优化要点
- [ ] 可以进行基础的问题调试

## 🎓 进阶方向

根据你的兴趣，可以选择以下专业方向：

1. **算法研究**: 深入研究MCTS算法的改进
2. **工程优化**: 专注于性能优化和系统架构
3. **应用扩展**: 将技术应用到其他领域
4. **评估分析**: 深入研究代码质量评估方法

记住：学习是一个渐进的过程，不要急于求成。每个阶段都要确保理解透彻再进入下一阶段！

有任何问题随时问我，我会帮你解答和指导。🚀